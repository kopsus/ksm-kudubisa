generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "mysql"
  url      = env("DATABASE_URL")
}

enum EnumRole {
  Masyarakat
  Agen
  Pengepul
  Admin
}

model User {
  id                  String       @id @default(cuid())
  username            String       @unique
  namaLengkap         String
  noTlp               String
  rt                  String?
  rw                  String?
  password            String
  role                EnumRole @default(Masyarakat)
  transaksi           Transaksi[] 

  createdAt           DateTime    @default(now()) @map("created_at")
  updatedAt           DateTime    @updatedAt @map("updated_at")
}

enum EnumStatus {
  Pending
  Process
  Paid
  Failed
}

model Transaksi {
  id                    String             @id @default(cuid())
  userId                String
  user                  User               @relation(fields: [userId], references: [id], onDelete: Cascade)
  statusUser            EnumStatus?
  statusAgen            EnumStatus?
  updatedByRoleAgen     String?
  updatedByRolePengepul String?
  updatedByAgen         EnumRole @default(Agen)
  updatedByPengepul     EnumRole @default(Pengepul)

  TransaksiProduk       TransaksiProduk[]  

  createdAt             DateTime           @default(now()) @map("created_at")
  updatedAt             DateTime           @updatedAt @map("updated_at")
}


model TransaksiProduk {
  id          String     @id @default(cuid())
  transaksiId String
  produkId    String
  quantity    Int
  transaksi   Transaksi  @relation(fields: [transaksiId], references: [id], onDelete: Cascade) // Relasi ke Transaksi
  produk      Produk     @relation(fields: [produkId], references: [id], onDelete: Cascade)   // Relasi ke Produk

  createdAt   DateTime   @default(now()) @map("created_at")
  updatedAt   DateTime   @updatedAt @map("updated_at")
}

enum EnumJenisSampah {
  SudahDiPilah
  BelumDiPilah
}

model Produk {
  id            String       @id @default(cuid())
  product_name  String       @unique
  price         Float
  image         String
  jenis         EnumJenisSampah
  transaksi     TransaksiProduk[] // Relasi balik ke TransaksiProduk

  createdAt     DateTime     @default(now()) @map("created_at")
  updatedAt     DateTime     @updatedAt @map("updated_at")
}

model Gallery {
  id            String @id @default(cuid())
  image         String
  createdAt     DateTime  @default(now()) @map("created_at")
  updatedAt     DateTime  @default(now()) @map("updated_at") 
}
